\section{Answer Set Programming}\label{sec:asp}

In questa sezione approfondiamo l'organizzazione del progetto, evidenziando 
come sia stato strutturato per garantire chiarezza e modularità. 
Per facilitare l'ordine visivo e semplificare eventuali ispezioni manuali, 
il progetto è stato suddiviso in più file sorgenti, ciascuno dedicato a un 
aspetto specifico del dataset e delle regole.

Abbiamo separato i fatti e le regole in due file principali: uno dedicato 
ai docenti (Sezione~\ref*{sec:rules-docenti}) e un altro focalizzato sulle 
coperture (Sezione~\ref*{sec:rules-coperture}). Per maggiore praticità, è 
stato creato un file specifico per i docenti a contratto 
(Sezione~\ref*{sec:rules-docenti-contratto}) e un altro per i limiti 
ministeriali (Sezione~\ref*{sec:rules-ministeriale}).

Il file principale, il main, integra tutte le regole relative ai garanti, 
inclusi i vincoli e le priorità definite per l'ottimizzazione del sistema 
(Sezione~\ref*{sec:constraints}).

È importante sottolineare che tutti questi file vengono generati dinamicamente 
dal programma di preprocessing scritto in Python. Questa fase, gestita dal 
file main del preprocessing, automatizza la creazione delle regole e dei 
fatti ASP in base ai dati forniti, garantendo così una configurazione 
personalizzata e facilmente aggiornabile. 


\subsection{Docenti}\label{sec:rules-docenti}
Il file \texttt{docenti.lp} contiene una rappresentazione strutturata delle 
informazioni relative ai docenti, organizzate in diverse sezioni per garantire 
chiarezza e modularità. Questo file serve come base per definire le caratteristiche 
dei docenti e il loro SSD.

La prima parte del file definisce gli SSD disponibili, ognuno rappresentato da una 
coppia di valori: la disciplina e il livello associato (e.g., INF/01, MAT/03). Gli SSD 
sono utilizzati per verificare la compatibilità tra i docenti e i corsi di laurea.

Successivamente, vengono dichiarate le fasce contrattuali dei docenti (\texttt{td} 
per tempo determinato, \texttt{ti} per tempo indeterminato). Queste fasce sono 
utilizzate per distinguere i docenti in base alla loro tipologia di contratto,
\scolli{Aggiungerei un "distinguendo i professori associati e ordinari dai ricercatori"}
aspetto rilevante per rispettare i requisiti ministeriali.

La sezione relativa ai docenti include l'elenco completo dei docenti, ciascuno 
identificato da una matricola unica. Per ogni docente, vengono indicate la fascia 
contrattuale e il settore scientifico disciplinare caratterizzante, che ne 
definisce il dominio di competenza. Queste informazioni sono formalizzate tramite 
il predicato \texttt{docente/4}, che associa la matricola del docente, la fascia, 
il settore disciplinare e il livello SSD.

Di seguito, riportiamo un esempio per illustrare la struttura dei dati contenuti nel file.

\begin{lstlisting}[language=prolog, caption={Esempio struttura dati di \texttt{docenti.lp}.}]    
 %  SEZIONE: SSD
 ssd(inf, 1).

 %  SEZIONE: FASCIE
 fascia(td).
 fascia(ti).

 %  SEZIONE: Docenti
 %  Rossi Mario (1234), SSD caratterizzante: inf/1
 matricola_docente(1234).

 %  SEZIONE: SSD caratterizzante dei docenti
 %  Rossi Mario (1234), SSD caratterizzante: inf/1
 docente(1234, td, inf, 1) :- matricola_docente(1234), fascia(td), ssd(inf, 1).
\end{lstlisting}


\subsection{Coperture}\label{sec:rules-coperture}
Il file \texttt{coperture.lp} è fondamentale per rappresentare la struttura dei 
corsi universitari, le informazioni sui docenti assegnati e le caratteristiche 
associate a ciascun corso. Questo file contiene diverse sezioni organizzate per 
garantire chiarezza e modularità nella definizione delle informazioni.

La prima parte del file introduce i tipi di corso (\texttt{laurea/1}) e i relativi 
SSD utilizzati per caratterizzare i corsi e i docenti. Successivamente, vengono 
definiti i TAF (Tipologia Attività Formativa), che classificano ulteriormente 
gli insegnamenti.

Le informazioni sui corsi sono strutturate in due livelli: i codici identificativi 
di ciascun corso (\texttt{codice\_corso/1}) e la loro descrizione dettagliata 
tramite il predicato \texttt{corso/4}. Quest'ultimo associa il codice del corso, 
il tipo di laurea, il SSD caratterizzante e il livello del settore disciplinare.

Una parte cruciale del file riguarda la relazione tra corsi e docenti, formalizzata 
tramite il predicato \texttt{cattedra/4}. Questo predicato associa un docente 
(identificato tramite la matricola) a un corso specifico, includendo il tipo di 
laurea e il TAF relativo. 

Di seguito, un esempio rappresentativo del contenuto del file.

\begin{lstlisting}[language=prolog, caption={Esempio struttura dati di \texttt{coperture.lp}.}]    
 %  SEZIONE: Tipi di Corso
 laurea(lt).
 laurea(lm).

 %  SEZIONE: TAF
 taf(b).
 taf(a).
 taf(c).

 %  SEZIONE: Corsi
 %  INFORMATICA (3027)
 codice_corso(3027).

 %  SEZIONE: Informazioni Corsi
 corso(3027, lt, inf, 1) :- codice_corso(3027), laurea(lt), ssd(inf, 1).

 %  SEZIONE: Relazioni Corsi-Docenti
 %  Corso: 3027, Docente: Rossi Mario
 cattedra(3027, 1234, lt, b) :- codice_corso(3027), 
                                matricola_docente(1234), 
                                laurea(lt), taf(b).

\end{lstlisting}


\subsection{Docenti a contratto}\label{sec:rules-docenti-contratto}

Il file \texttt{docenti\_a\_contratto.lp} contiene le informazioni relative ai docenti 
a contratto, una categoria di docenti utilizzata come risorsa di emergenza nei casi in 
cui non è possibile soddisfare i vincoli ministeriali con i docenti a tempo determinato 
o indeterminato. Questi docenti sono identificati tramite la fascia \texttt{c} e vengono 
impiegati come \textit{jolly}, ovvero come soluzioni di riserva per garantire la copertura 
minima dei corsi universitari.

All'interno del file, ogni docente a contratto è identificato tramite la sua matricola 
ed è marcato con il predicato \texttt{jolly/1}. Questo predicato segnala che il docente può 
essere assegnato a qualsiasi corso, indipendentemente dall'SSD. I docenti a contratto 
non sono associati a uno specifico corso o SSD come i docenti a tempo determinato o 
indeterminato, ma possono essere impiegati in modo flessibile per \textit{"tappare i buchi"} 
e assicurare che tutti i corsi soddisfino i requisiti minimi.

L'utilizzo dei docenti a contratto nel modello ASP è strettamente regolato. Essi sono 
inclusi come possibili garanti nei corsi, ma il loro utilizzo è penalizzato nel processo 
di ottimizzazione, al fine di privilegiare i docenti delle altre fasce. Questa scelta 
garantisce che i docenti a contratto siano usati solo come ultima risorsa, minimizzando 
il loro impatto sulla soluzione complessiva. Approfondiremo meglio questa questione nella 
Sezione~\ref*{sec:priorita}.

Di seguito è riportato un esempio della struttura del file:

\begin{lstlisting}[language=prolog, caption={Esempio struttura dati di \texttt{docenti\_a\_contratto.lp}.}]    
 %  SEZIONE: FASCIE
 fascia(c).

 %  SEZIONE: Docenti
 %  Rossi Mario (1234), docente a contratto
 matricola_docente(1234).
 jolly(1234).
\end{lstlisting}


\subsection{Limiti ministeriali}\label{sec:rules-ministeriale}

Il file \texttt{ministeriale.lp} contiene i dati relativi ai requisiti ministeriali per 
ogni corso di laurea, con particolare riferimento al numero minimo di garanti richiesti 
per ciascun corso. Ogni corso ha associato un insieme di valori che determinano i vincoli 
di assegnazione dei docenti, inclusi i docenti a tempo indeterminato e tempo determinato,
e il numero massimo di docenti a contratto.

Le regole \texttt{ministeriale/5} sono calcolate dinamicamente durante la fase di 
preprocessing. In particolare, questi valori sono determinati sulla base del numero di 
studenti iscritti a ciascun corso e grazie all'applicazione della formula della \textit{W}, 
come illustrato nella Tabella~\ref{tab:formula-w}, che tiene conto delle specifiche 
necessità di copertura di ciascun corso. Nello specifico, la $W$ viene calcolata nel 
seguente modo:
$$
W = \frac{
        \text{Studenti iscritti al corso}
    }
    {
        \text{Massimo teorico di iscritti al corso}
    }
    - 1
$$

Di seguito un esempio della struttura del file per il corso di Informatica, per 
il quale sono richiesti almeno 9 garanti, di cui 5 a tempo indeterminato, 4 a tempo 
determinato, e un massimo di 2 docenti a contratto. 

\begin{lstlisting}[language=prolog, caption={Esempio struttura dati di \texttt{ministeriale.lp}.}]    
 %  SEZIONE: Garanti minimi per corso (codice_corso, minimo_complessivo, 
 %                                     docenti_ti, docenti_td, 
 %                                     max_docenti_contratto)
 ministeriale(3027, 9, 5, 4, 2).
\end{lstlisting} 

\begin{table}[h]
    \centering
    \renewcommand{\arraystretch}{1.5}
    \begin{tabular}{|l|c|c|}
    \hline
    \textbf{Qualifica} & \textbf{\# base} & \textbf{\# effettivo} \\
    \hline
    Docenza di riferimento & 9 & $\lfloor 9 \times (1+w) \rfloor$ \\
    \hline
    Docenti a tempo indeterminato & 5 & $\lfloor 5 \times (1+w) \rfloor$ \\
    \hline
    Docenti non appartenenti all'ateneo & 3 & $\lfloor 3 \times (1+w) \rfloor$ \\
    \hline
    \end{tabular}
    \caption{Formule per il calcolo del numero di docenti di riferimento in base alla numerosità degli studenti.}
    \label{tab:formula-w}
\end{table}


\subsection{Vincoli}\label{sec:constraints}
\mmerenda{sistemare e aggiungere i vincoli}
\mmerenda{scrivere la roba dei pesi}

Nel modello proposto abbiamo introdotto una serie di vincoli deboli per avere
maggiore flessibilità nella gestione di situazioni in cui non è possibile rispettare
rigorosamente i requisiti ministeriali.

\begin{lstlisting}[language=prolog, caption=Vincoli di flessibilità]
% Vincolo: il numero di docenti a tempo indeterminato per ogni corso deve
% essere almeno pari al minimo ministeriale richiesto.
% Se il numero e' inferiore al minimo, la soluzione viene scartata.
% ! weak constraint
:~ conta_docenti_indeterminato(Corso, Numero),
        ministeriale(Corso, Minimo, Minimo_ind, _, _),
        codice_corso(Corso),
        Numero < Minimo_ind.
        [Numero * 10@1]

% Vincolo: il numero di docenti a tempo determinato per ogni corso non deve
% essere superiore al massimo ministeriale richiesto.
% Se il numero e' superiore al massismo, la soluzione viene scartata.
% Penalizzazione per ricercatori che superano il limite consentito
% ! weak constraint
:~ conta_docenti_determinato(Corso, Numero),
        ministeriale(Corso, _, _, Massimo_det, _),
        Numero > Massimo_det,
        Penalita = Numero - Massimo_det.
        [Penalita * 50@1]
% Vincolo: il numero di docenti che afferiscono al SSD del corso deve rappresentare almeno il 50%
% del numero totale di docenti di riferimento.
% Se la condizione non e' soddisfatta, la soluzione viene scartata.
% ! weak constraint
:~ numero_docenti_che_afferiscono(Aff), 
        numero_docenti_di_riferimento(Tot),
        2 * Aff <= Tot. 
        [Tot - 4 * Aff@1]
\end{lstlisting}

\begin{lstlisting}[language=prolog, caption=Minimizzazione dei garanti per corso di laurea.]
% Vincolo debole per minimizzare il numero di garanti effettivi rispetto al minimo richiesto.
% Penalizza le soluzioni in cui il numero di garanti effettivi
% (calcolato da `garanti_per_corso`) non coincide con il numero minimo
% stabilito dai requisiti ministeriali per il corso.
:~ garanti_per_corso(Corso, Numero),
        ministeriale(Corso, Minimo, _, _, _),
        Numero != Minimo.
        [Numero * Minimo@1]
\end{lstlisting}


\subsection{Gestione delle priorità}\label{sec:priorita}
La gestione delle priorità è stata un aspetto fondamentale nel nostro progetto, poiché 
miravamo a rispettare scrupolosamente i vincoli ministeriali, garantendo al contempo 
flessibilità per gestire situazioni particolari in cui tali vincoli non fossero 
pienamente soddisfacibili.

Per organizzare le priorità dei garanti, abbiamo deciso di basarci, in seguito ad un 
colloquio con l'ufficio didattico, principalmente sulla loro tipologia contrattuale. 
Il nostro obiettivo era quello di massimizzare l'impiego di docenti a tempo determinato 
(i.e., ricercatori) e a tempo indeterminato (i.e., professori associati e ordinari), prima 
di ricorrere ai docenti a contratto, che sono utilizzati solo quando strettamente necessario. 
Per ottimizzare la gestione, abbiamo preferito che i docenti assumessero il ruolo di 
garanti per un solo corso, evitando situazioni in cui un docente fosse impegnato come 
garante per più corsi contemporaneamente al 50\%.

Abbiamo implementato queste priorità nel nostro modello con l'ausilio di regole di 
massimizzazione e minimizzazione, come mostrato di seguito:

\begin{lstlisting}[language=prolog, caption=Gestione delle priorità dei docenti.]
% Docenti a tempo determinato (ricercatori)
#maximize { 50 : garante(_, _, _, td) }.

% Docenti a tempo indeterminato
#maximize { 40 : garante(_, _, _, ti) }.

% Docenti a contratto
#maximize { 32 : garante(_, _, _, c) }.

% Docenti con peso 10
#maximize { 25 : garante(_, _, Peso, _), Peso = 10 }.

% Minimizzare i docenti con peso 5
#minimize { 100, Docente : garante(Docente, _, Peso, _), Peso = 5 }.
\end{lstlisting}

Inoltre, abbiamo dato priorità ai docenti che insegnano corsi fondamentali per i 
corsi di laurea, distinguendo tra gli insegnamenti di base, identificati dal TAF A, 
e gli insegnamenti caratterizzanti, identificati dal TAF B.

\begin{lstlisting}[language=prolog, caption=Gestione delle priorità del TAF.]
 % Garanti che hanno insegnamenti di base
 #maximize { 25 : garante(Docente, Corso, _, _), 
                  cattedra(Corso, Docente, _, TAF), 
                  TAF = a}.

 % Garanti che hanno insegnamenti caratterizzanti
 #maximize { 18 : garante(Docente, Corso, _, _), 
                  cattedra(Corso, Docente, _, TAF), 
                  TAF = b}.

 % Garanti che hanno insegnamenti affini
 #maximize { 10 : garante(Docente, Corso, _, _), 
                  cattedra(Corso, Docente, _, TAF), 
                  TAF = c}.
\end{lstlisting}

Per ottimizzare l'assegnazione dei garanti in base alla loro competenza, sono stati 
privilegiati i docenti il cui l'SSD corrisponde a quello caratterizzante del corso.
In questo modo, ci siamo assicurati che i garanti siano adeguatamente allineati con 
le competenze richieste dai corsi.

\begin{lstlisting}[language=prolog, caption=Preferenza dei garanti con macrosettore coerente a quello del corso.]
% Ottimizzare i garanti con SSD caratterizzante
#maximize { 20 : garante(Docente, Corso, _, _), 
                 docente(Docente, _, SettoreSSD, _), 
                 corso(Corso, _, SettoreSSD, _) }.
\end{lstlisting}

Infine, per mantenere l'equilibrio tra la qualità e l'efficacia del sistema, abbiamo 
minimizzato il numero di garanti assegnati a ciascun corso, penalizzando le situazioni 
in cui il numero di garanti supera il minimo richiesto. Questo vincolo ci ha permesso 
di ottimizzare le risorse, evitando l'assegnazione di più docenti di quanto fosse necessario.

\begin{lstlisting}[language=prolog, caption=Minimizzazione dei garanti per corso di laurea.]
% Minimizzo il numero di garanti per ogni corso
#minimize { Penalita : garanti_per_corso(Corso, Numero),
                       Penalita = Numero * 10 }.
\end{lstlisting}

\subsection{Ottimizzzazioni}\label{sec:optimizations}